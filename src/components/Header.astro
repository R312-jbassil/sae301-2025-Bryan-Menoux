---
import logo from "../assets/logo.svg";
import cart from "../assets/cart.svg";
import save from "../assets/save.svg";
import user from "../assets/user.svg";

const isAuthenticated = !!Astro.cookies.get("pb_auth")?.value;
---

<header
  class="fixed top-0 left-0 w-full bg-base-100 border-b border-base-300 z-100"
>
  <div class="flex items-center justify-between px-4 py-3 lg:px-8">
    <div class="flex items-center gap-2">
      <a href="/" class="flex items-center gap-2">
        <img
          src={logo.src}
          alt="Logo TaVue"
          class="h-6 md:h-7 lg:h-7 xl:h-8 w-auto"
        />
        <span
          class="tracking-tight text-base-content text-2xl md:text-3xl lg:text-3xl xl:text-4xl font-bold"
          >TA VUE</span
        >
      </a>
    </div>

    <nav
      class="hidden xl:flex gap-8 text-base xl:text-lg text-base-content font-medium"
    >
      <a href="#" class="hover:text-primary transition-colors"
        >Choix du modèle</a
      >
      <a href="/configurateur" class="hover:text-primary transition-colors"
        >Personnalisation de votre modèle</a
      >
      <a href="/panier" class="hover:text-primary transition-colors">Panier</a>
    </nav>

    <div class="flex items-center gap-4">
      <div
        class="hidden xl:flex items-center bg-white border border-[#d2d9e3] rounded-full px-4 py-2 transition-colors duration-200 focus-within:border-[#3b82f6] min-w-[300px] gap-4"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 text-[#64748b] shrink-0"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="m21 21-4.35-4.35M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16z"></path>
        </svg>
        <input
          type="text"
          placeholder="Rechercher"
          class="search-input ml-2 text-base"
        />
      </div>

      <div class="flex items-center gap-3 md:gap-4 text-neutral/80">
        <a href="/panier" class="hover:text-primary transition-colors">
          <img src={cart.src} alt="Panier" class="h-6 md:h-7 lg:h-6 w-auto" />
        </a>
        <a href="#" class="hover:text-primary transition-colors">
          <img
            src={save.src}
            alt="Sauvegarder"
            class="h-6 md:h-7 lg:h-6 w-auto"
          />
        </a>
        {
          isAuthenticated ? (
            <button
              id="logout-btn"
              class="btn btn-outline btn-sm"
              aria-label="Déconnexion"
            >
              Déconnexion
            </button>
          ) : (
            <a href="/login" class="hover:text-primary transition-colors">
              <img
                src={user.src}
                alt="Utilisateur"
                class="h-6 md:h-7 lg:h-6 w-auto"
              />
            </a>
          )
        }

        <button
          id="menu-toggle"
          class="flex flex-col justify-center items-center w-8 h-8 rounded-md hover:bg-base-200 transition xl:hidden"
          aria-label="Ouvrir le menu"
        >
          <div
            class="w-5 h-0.5 bg-base-content transition-all duration-300 origin-center"
          >
          </div>
          <div
            class="w-5 h-0.5 bg-base-content mt-1 transition-all duration-300 origin-center"
          >
          </div>
          <div
            class="w-5 h-0.5 bg-base-content mt-1 transition-all duration-300 origin-center"
          >
          </div>
        </button>
      </div>
    </div>
  </div>

  <nav
    id="mobile-menu"
    class="fixed top-0 left-0 w-full h-screen bg-base-100 flex flex-col justify-start pt-[25vh] items-center gap-6 py-8 text-xl md:text-2xl font-medium text-base-content -z-40 xl:hidden"
    style="display: none;"
  >
    <a href="#" class="hover:text-primary transition-colors">Choix du modèle</a>
    <a href="configurateur" class="hover:text-primary transition-colors"
      >Personnalisation</a
    >
    <a href="/panier" class="hover:text-primary transition-colors">Panier</a>
    <a href="/login" class="hover:text-primary transition-colors">Mon compte</a>
  </nav>

  <script>
    const toggle = document.getElementById("menu-toggle");
    const menu = document.getElementById("mobile-menu");
    const logoutBtn = document.getElementById("logout-btn");
    let open = false;

    if (logoutBtn) {
      logoutBtn.addEventListener("click", async () => {
        try {
          const response = await fetch("/apis/logout", { method: "GET" });
          if (response.ok) {
            window.location.reload();
          }
        } catch (error) {
          console.error("Erreur lors de la déconnexion:", error);
        }
      });
    }

    if (toggle && menu) {
      toggle.addEventListener("click", () => {
        open = !open;
        menu.style.display = open ? "flex" : "none";
        document.body.classList.toggle("overflow-hidden", open);

        const bars = toggle.querySelectorAll("div");
        if (open) {
          bars[0].classList.add("rotate-45", "translate-y-[6px]");
          bars[1].classList.add("opacity-0");
          bars[2].classList.add("-rotate-45", "-translate-y-[6px]");
        } else {
          bars.forEach((b) =>
            b.classList.remove(
              "rotate-45",
              "-rotate-45",
              "translate-y-[6px]",
              "-translate-y-[6px]",
              "opacity-0"
            )
          );
        }
      });
    }
  </script>
</header>
