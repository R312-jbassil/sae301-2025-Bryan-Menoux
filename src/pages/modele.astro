---
import Layout from "../layouts/Layout.astro";
import checkIcon from "../assets/check.svg";
import garantIcon from "../assets/garant.svg";
import Lunettes from "../components/Lunettes.astro";
import personnaliserIcon from "../assets/personnaliser.svg";
import cartIcon from "../assets/cart.svg";
---

<Layout>
  <div class="w-full flex flex-col items-center gap-4 mb-4 bg-white p-8">
    <h1 class="text-3xl font-bold">Choix du modèle</h1>
    <p class="text-gray-600 text-center">
      Sélectionnez le modèle de lunettes qui vous convient le mieux.
    </p>
    <div class="flex gap-4 justify-center flex-wrap">
      <div class="flex items-center gap-2">
        <img src={checkIcon.src} alt="Check" class="w-5 h-5" />
        <span class="text-sm">Fabrication française</span>
      </div>
      <div class="flex items-center gap-2">
        <img src={garantIcon.src} alt="Garant" class="w-5 h-5" />
        <span class="text-sm">Garantie 2 ans</span>
      </div>
    </div>
  </div>

  <main class="flex flex-col items-center gap-8 mt-16 px-4">
    <div id="main-content" class="w-full flex flex-col items-center gap-8">
      <div class="w-full max-w-4xl mx-auto mb-8">
        <div class="flex items-center justify-between">
          <!-- Step 1 -->
          <div class="flex flex-col items-center">
            <div
              class="w-12 h-12 rounded-full bg-accent text-white flex items-center justify-center font-bold text-lg"
            >
              1
            </div>
            <span class="text-sm font-medium mt-2 text-center"
              >Choix du modèle</span
            >
          </div>

          <!-- Line between Step 1 and 2 -->
          <div
            class="flex-1 h-1 bg-gray-300"
            style="align-self: flex-start; margin-top: 24px;"
          >
          </div>

          <!-- Step 2 -->
          <div class="flex flex-col items-center">
            <div
              class="w-12 h-12 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold text-lg"
            >
              2
            </div>
            <span class="text-sm font-medium mt-2 text-center"
              >Configuration</span
            >
          </div>

          <!-- Line between Step 2 and 3 -->
          <div
            class="flex-1 h-1 bg-gray-300"
            style="align-self: flex-start; margin-top: 24px;"
          >
          </div>

          <!-- Step 3 -->
          <div class="flex flex-col items-center">
            <div
              class="w-12 h-12 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold text-lg"
            >
              3
            </div>
            <span class="text-sm font-medium mt-2 text-center">Paiement</span>
          </div>
        </div>
      </div>

      <style>
        /* Responsive: stack preview above params on small screens, two columns on desktop (>=1024px) */
        .config-grid {
          display: grid;
          grid-template-columns: 1fr;
          gap: 2rem;
          width: 100%;
          max-width: 1200px;
          align-items: start;
        }

        @media (min-width: 1024px) {
          .config-grid {
            grid-template-columns: 1fr 1fr;
          }
        }

        /* Keep left column sticky when scrolling */
        .sticky-column {
          position: -webkit-sticky;
          position: sticky;
          top: 10dvh; /* offset from top */
          z-index: 10;
          height: fit-content;
        }
      </style>

      <div class="config-grid">
        <!-- Colonne gauche: Aperçu -->
        <div class="w-full space-y-4 sticky-column">
          <div
            class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm"
          >
            <div
              class="px-6 py-6 flex justify-between items-center text-gray-800 text-sm font-semibold"
            >
              <span>Aperçu</span>
              <button
                id="fullscreen-btn"
                class="bg-none border-none cursor-pointer p-0 flex items-center justify-center"
              >
                <svg
                  class="w-5 h-5 text-gray-400 hover:text-gray-600 transition-colors"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
              </button>
            </div>

            <div
              class="flex justify-center items-center bg-gray-50 px-6 py-8 mx-4 rounded min-h-80"
            >
              <Lunettes />
            </div>

            <div class="flex justify-center items-center gap-3 px-6 py-6">
              <button
                id="vue-avant"
                class="bg-white text-blue-600 border-[1.5px] border-blue-600 px-3.5 py-1 rounded-full cursor-pointer text-xs font-medium transition-all duration-200"
              >
                Vue Avant
              </button>
              <span
                id="vue-profil"
                class="text-gray-500 text-xs cursor-pointer font-normal"
              >
                Vue Profil
              </span>
            </div>
          </div>
        </div>

        <!-- Colonne droite: Détails -->
        <div class="w-full space-y-8">
          <!-- Badge Stock -->
          <div class="flex gap-2">
            <span
              class="inline-block px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded"
            >
              Modèle Signature
            </span>
            <span
              class="inline-block px-3 py-1 bg-green-100 text-green-700 text-xs font-medium rounded"
            >
              En stock
            </span>
          </div>

          <!-- Titre et Prix -->
          <div>
            <h2 class="text-2xl font-bold text-gray-900 mb-2">
              TaVue Signature
            </h2>
            <p class="text-gray-600 text-sm mb-4">
              Notre modèle emblématique qui allie élégance intemporelle et
              confort ultime. Conçu en France avec des matériaux premium, le
              TaVue Signature incarne notre savoir-faire et notre engagement
              qualité.
            </p>
            <div class="flex items-baseline gap-2">
              <span class="text-3xl font-bold text-gray-900">289 €</span>
              <span class="text-lg text-gray-500 line-through">349 €</span>
              <span class="text-sm font-semibold text-red-600">-17%</span>
            </div>
          </div>

          <!-- Caractéristiques principales -->
          <div>
            <h3 class="text-sm font-semibold text-gray-900 mb-3">
              Caractéristiques principales
            </h3>
            <div class="space-y-2">
              <div class="flex items-start gap-2">
                <svg
                  class="w-5 h-5 text-green-600 shrink-0 mt-0.5"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd"></path>
                </svg>
                <div>
                  <p class="text-sm font-medium text-gray-900">
                    Matériau de la monture
                  </p>
                  <p class="text-xs text-gray-600">
                    Acétate de cellulose premium • Léger • Hypoallergénique et
                    durable
                  </p>
                </div>
              </div>
              <div class="flex items-start gap-2">
                <svg
                  class="w-5 h-5 text-green-600 shrink-0 mt-0.5"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd"></path>
                </svg>
                <div>
                  <p class="text-sm font-medium text-gray-900">Dimensions</p>
                  <p class="text-xs text-gray-600">
                    Largeur verres: 47mm • Hauteur: 38mm • Pont: 18mm
                  </p>
                </div>
              </div>
              <div class="flex items-start gap-2">
                <svg
                  class="w-5 h-5 text-green-600 shrink-0 mt-0.5"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd"></path>
                </svg>
                <div>
                  <p class="text-sm font-medium text-gray-900">Finition</p>
                  <p class="text-xs text-gray-600">
                    Agir mat avec vernis uniformisé blended
                  </p>
                </div>
              </div>
              <div class="flex items-start gap-2">
                <svg
                  class="w-5 h-5 text-green-600 shrink-0 mt-0.5"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd"></path>
                </svg>
                <div>
                  <p class="text-sm font-medium text-gray-900">Style</p>
                  <p class="text-xs text-gray-600">
                    Intemporel • Design harmonieux • Adapté aux visages ovales
                    et carrés
                  </p>
                </div>
              </div>
              <div class="flex items-start gap-2">
                <svg
                  class="w-5 h-5 text-green-600 shrink-0 mt-0.5"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd"></path>
                </svg>
                <div>
                  <p class="text-sm font-medium text-gray-900">
                    Options incluses
                  </p>
                  <p class="text-xs text-gray-600">
                    Charnières renforcées • Embouts ergonomiques • Étui rigide
                    premium
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Boutons d'action -->
          <div class="space-y-3">
            <button
              id="personnaliser-btn"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2"
            >
              <img
                src={personnaliserIcon.src}
                alt="Personnaliser"
                class="w-5 h-5"
              />
              Personnaliser ce modèle
            </button>
            <button
              class="w-full border border-gray-300 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-50 transition-colors duration-200 flex items-center justify-center gap-2"
            >
              <img src={cartIcon.src} alt="Panier" class="w-5 h-5" />
              Ajouter au panier
            </button>
          </div>

          <!-- Description détaillée -->
          <div class="border-t pt-6">
            <h3 class="text-sm font-semibold text-gray-900 mb-3">
              Description détaillée
            </h3>
            <p class="text-xs text-gray-600 leading-relaxed mb-3">
              La TaVue Signature représente l'essence même de notre marque: un
              design épuré et intemporel, des matériaux de qualité supérieure et
              un confort sans compromis. Chaque paire est minutieusement
              fabriquée dans nos ateliers en France, garantissant une qualité
              irréprochable.
            </p>
            <p class="text-xs text-gray-600 leading-relaxed">
              Les verres anti-reflet traités spécialement réduisent les reflets
              gênants et offrent une vision cristalline. La monture en acétate
              de cellulose offre à la fois robustesse et légèreté, tandis que
              les charnières renforcées assurent une durabilité optimale.
              Bénéficiez de notre garantie 2 ans complète sur l'ouvrage de
              réparation.
            </p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script is:inline>
    // Bouton Personnaliser ce modèle
    const personnaliserBtn = document.getElementById("personnaliser-btn");

    personnaliserBtn?.addEventListener("click", () => {
      // Récupérer les données existantes ou initialiser
      let couleursLunettes = JSON.parse(
        localStorage.getItem("couleursLunettes") || "{}"
      );
      let materiaux = JSON.parse(localStorage.getItem("materiaux") || "{}");
      let optionsVerres = JSON.parse(
        localStorage.getItem("optionsVerres") || "{}"
      );
      let tailles = JSON.parse(localStorage.getItem("tailles") || "{}");
      let finitions = JSON.parse(localStorage.getItem("finitions") || "{}");

      // Appliquer les paramètres du modèle "TaVue Signature"
      couleursLunettes.monture = "#ff4757";
      couleursLunettes.branches = "#4169E1";

      materiaux.monture = "acetate";
      materiaux.branches = "acetate";

      optionsVerres.traitementVerres = "antireflet";
      optionsVerres.verresTeintes = false;

      tailles.largeurVerres = "47";
      tailles.hauteurVerres = "38";
      tailles.largeurPont = "18";

      finitions.finition = "mat";

      // Sauvegarder dans localStorage
      localStorage.setItem(
        "couleursLunettes",
        JSON.stringify(couleursLunettes)
      );
      localStorage.setItem("materiaux", JSON.stringify(materiaux));
      localStorage.setItem("optionsVerres", JSON.stringify(optionsVerres));
      localStorage.setItem("tailles", JSON.stringify(tailles));
      localStorage.setItem("finitions", JSON.stringify(finitions));

      // Rediriger vers le configurateur
      window.location.href = "/configurateur";
    });
  </script>
</Layout>
